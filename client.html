<!DOCTYPE html>
<html>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="stats"></div>

    <script>
        const canvas = document.getElementById('gameCanvas')
        const ctx = canvas.getContext('2d')
        const stats = document.getElementById('stats')
        let lastTimestamp = 0

        // 初始化WebSocket
        const ws = new WebSocket('ws://localhost:8000')
        
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data)
            
            // 渲染画面
            if(data.type === 'frame') {
                const img = new Image()
                img.onload = () => {
                    canvas.width = img.naturalWidth
                    canvas.height = img.naturalHeight
                    ctx.drawImage(img, 0, 0)
                    
                    // 显示性能统计
                    const latency = Date.now() - data.timestamp * 1000
                    stats.innerHTML = `
                        分辨率: ${canvas.width}x${canvas.height}<br>
                        延迟: ${latency.toFixed(1)}ms<br>
                        帧率: ${(1000 / (Date.now() - lastTimestamp)).toFixed(1)} FPS
                    `
                    lastTimestamp = Date.now()
                }
                img.src = `data:image/png;base64,${data.data}`
            }
        }

        // 自动重连
        ws.onclose = () => setTimeout(() => location.reload(), 1000)
    </script>

    <style>
        body { margin: 0; background: #1a1a1a; }
        #gameCanvas { box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        #stats {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #fff;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            font-family: monospace;
        }
    </style>
</body>
</html>